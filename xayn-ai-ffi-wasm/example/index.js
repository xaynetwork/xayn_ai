import * as Comlink from "comlink";

(async function init() {
  const worker = new Worker(new URL("./worker.js", import.meta.url), {
    type: "module",
  });
  // WebWorkers use `postMessage` and therefore work with Comlink.
  const ai = await Comlink.wrap(worker).handle;

  console.time("rerank");
  let ranks = await ai.rerank(1, [], documents());
  console.timeEnd("rerank");
  console.log(ranks);

  for (let i = 0; i < 10; i++) {
    console.time("rerank");
    let ranks = await ai.rerank(1, history(), documents());
    console.timeEnd("rerank");
  }
})();

function history() {
  return [
    {
      id: "fcb6a685-eb92-4d36-8686-000000000000",
      relevance: 0,
      user_feedback: 1,
      session: "fcb6a685-eb92-4d36-8686-000000000001",
      query_count: 1,
      query_id: "fcb6a685-eb92-4d36-8686-000000000001",
      query_words: "transport mode",
      day: 0,
      url: "url-0",
      domain: "domain-0",
      rank: 0,
      user_action: 0,
    },
    {
      id: "fcb6a685-eb92-4d36-8686-000000000001",
      relevance: 1,
      user_feedback: 1,
      session: "fcb6a685-eb92-4d36-8686-000000000001",
      query_count: 2,
      query_id: "fcb6a685-eb92-4d36-8686-000000000001",
      query_words: "transport mode",
      day: 1,
      url: "url-1",
      domain: "domain-1",
      rank: 1,
      user_action: 0,
    },
    {
      id: "fcb6a685-eb92-4d36-8686-000000000002",
      relevance: 2,
      user_feedback: 1,
      session: "fcb6a685-eb92-4d36-8686-000000000001",
      query_count: 3,
      query_id: "fcb6a685-eb92-4d36-8686-000000000001",
      query_words: "transport mode",
      day: 2,
      url: "url-2",
      domain: "domain-2",
      rank: 2,
      user_action: 1,
    },
    {
      id: "fcb6a685-eb92-4d36-8686-000000000003",
      relevance: 0,
      user_feedback: 1,
      session: "fcb6a685-eb92-4d36-8686-000000000001",
      query_count: 4,
      query_id: "fcb6a685-eb92-4d36-8686-000000000001",
      query_words: "transport mode",
      day: 3,
      url: "url-3",
      domain: "domain-3",
      rank: 3,
      user_action: 2,
    },
    {
      id: "fcb6a685-eb92-4d36-8686-000000000004",
      relevance: 1,
      user_feedback: 1,
      session: "fcb6a685-eb92-4d36-8686-000000000001",
      query_count: 5,
      query_id: "fcb6a685-eb92-4d36-8686-000000000001",
      query_words: "transport mode",
      day: 4,
      url: "url-4",
      domain: "domain-4",
      rank: 4,
      user_action: 0,
    },
    {
      id: "fcb6a685-eb92-4d36-8686-000000000005",
      relevance: 2,
      user_feedback: 1,
      session: "fcb6a685-eb92-4d36-8686-000000000001",
      query_count: 6,
      query_id: "fcb6a685-eb92-4d36-8686-000000000001",
      query_words: "transport mode",
      day: 5,
      url: "url-5",
      domain: "domain-5",
      rank: 5,
      user_action: 1,
    },
    {
      id: "fcb6a685-eb92-4d36-8686-000000000006",
      relevance: 0,
      user_feedback: 0,
      session: "fcb6a685-eb92-4d36-8686-000000000001",
      query_count: 7,
      query_id: "fcb6a685-eb92-4d36-8686-000000000001",
      query_words: "transport mode",
      day: 6,
      url: "url-6",
      domain: "domain-6",
      rank: 6,
      user_action: 2,
    },
    {
      id: "fcb6a685-eb92-4d36-8686-000000000007",
      relevance: 1,
      user_feedback: 0,
      session: "fcb6a685-eb92-4d36-8686-000000000001",
      query_count: 8,
      query_id: "fcb6a685-eb92-4d36-8686-000000000001",
      query_words: "transport mode",
      day: 0,
      url: "url-7",
      domain: "domain-7",
      rank: 7,
      user_action: 0,
    },
    {
      id: "fcb6a685-eb92-4d36-8686-000000000008",
      relevance: 2,
      user_feedback: 0,
      session: "fcb6a685-eb92-4d36-8686-000000000001",
      query_count: 9,
      query_id: "fcb6a685-eb92-4d36-8686-000000000001",
      query_words: "transport mode",
      day: 1,
      url: "url-8",
      domain: "domain-8",
      rank: 8,
      user_action: 1,
    },
    {
      id: "fcb6a685-eb92-4d36-8686-000000000009",
      relevance: 2,
      user_feedback: 0,
      session: "fcb6a685-eb92-4d36-8686-000000000001",
      query_count: 10,
      query_id: "fcb6a685-eb92-4d36-8686-000000000001",
      query_words: "transport mode",
      day: 2,
      url: "url-9",
      domain: "domain-9",
      rank: 9,
      user_action: 2,
    },

    // {
    //   id: "fcb6a685-eb92-4d36-8686-000000000010",
    //   relevance: 2,
    //   user_feedback: 0,
    //   session: "fcb6a685-eb92-4d36-8686-000000000001",
    //   query_count: 10,
    //   query_id: "fcb6a685-eb92-4d36-8686-000000000001",
    //   query_words: "transport mode",
    //   day: 2,
    //   url: "url-9",
    //   domain: "domain-9",
    //   rank: 9,
    //   user_action: 2,
    // },
    // {
    //   id: "fcb6a685-eb92-4d36-8686-000000000011",
    //   relevance: 2,
    //   user_feedback: 0,
    //   session: "fcb6a685-eb92-4d36-8686-000000000001",
    //   query_count: 10,
    //   query_id: "fcb6a685-eb92-4d36-8686-000000000001",
    //   query_words: "transport mode",
    //   day: 2,
    //   url: "url-9",
    //   domain: "domain-9",
    //   rank: 9,
    //   user_action: 2,
    // },
    // {
    //   id: "fcb6a685-eb92-4d36-8686-000000000012",
    //   relevance: 2,
    //   user_feedback: 0,
    //   session: "fcb6a685-eb92-4d36-8686-000000000001",
    //   query_count: 10,
    //   query_id: "fcb6a685-eb92-4d36-8686-000000000001",
    //   query_words: "transport mode",
    //   day: 2,
    //   url: "url-9",
    //   domain: "domain-9",
    //   rank: 9,
    //   user_action: 2,
    // },
    // {
    //   id: "fcb6a685-eb92-4d36-8686-000000000013",
    //   relevance: 2,
    //   user_feedback: 0,
    //   session: "fcb6a685-eb92-4d36-8686-000000000001",
    //   query_count: 10,
    //   query_id: "fcb6a685-eb92-4d36-8686-000000000001",
    //   query_words: "transport mode",
    //   day: 2,
    //   url: "url-9",
    //   domain: "domain-9",
    //   rank: 9,
    //   user_action: 2,
    // },
    // {
    //   id: "fcb6a685-eb92-4d36-8686-000000000014",
    //   relevance: 2,
    //   user_feedback: 0,
    //   session: "fcb6a685-eb92-4d36-8686-000000000001",
    //   query_count: 10,
    //   query_id: "fcb6a685-eb92-4d36-8686-000000000001",
    //   query_words: "transport mode",
    //   day: 2,
    //   url: "url-9",
    //   domain: "domain-9",
    //   rank: 9,
    //   user_action: 2,
    // },
    // {
    //   id: "fcb6a685-eb92-4d36-8686-000000000015",
    //   relevance: 2,
    //   user_feedback: 0,
    //   session: "fcb6a685-eb92-4d36-8686-000000000001",
    //   query_count: 10,
    //   query_id: "fcb6a685-eb92-4d36-8686-000000000001",
    //   query_words: "transport mode",
    //   day: 2,
    //   url: "url-9",
    //   domain: "domain-9",
    //   rank: 9,
    //   user_action: 2,
    // },
    // {
    //   id: "fcb6a685-eb92-4d36-8686-000000000016",
    //   relevance: 2,
    //   user_feedback: 0,
    //   session: "fcb6a685-eb92-4d36-8686-000000000001",
    //   query_count: 10,
    //   query_id: "fcb6a685-eb92-4d36-8686-000000000001",
    //   query_words: "transport mode",
    //   day: 2,
    //   url: "url-9",
    //   domain: "domain-9",
    //   rank: 9,
    //   user_action: 2,
    // },
    // {
    //   id: "fcb6a685-eb92-4d36-8686-000000000017",
    //   relevance: 2,
    //   user_feedback: 0,
    //   session: "fcb6a685-eb92-4d36-8686-000000000001",
    //   query_count: 10,
    //   query_id: "fcb6a685-eb92-4d36-8686-000000000001",
    //   query_words: "transport mode",
    //   day: 2,
    //   url: "url-9",
    //   domain: "domain-9",
    //   rank: 9,
    //   user_action: 2,
    // },
    // {
    //   id: "fcb6a685-eb92-4d36-8686-000000000018",
    //   relevance: 2,
    //   user_feedback: 0,
    //   session: "fcb6a685-eb92-4d36-8686-000000000001",
    //   query_count: 10,
    //   query_id: "fcb6a685-eb92-4d36-8686-000000000001",
    //   query_words: "transport mode",
    //   day: 2,
    //   url: "url-9",
    //   domain: "domain-9",
    //   rank: 9,
    //   user_action: 2,
    // },
    // {
    //   id: "fcb6a685-eb92-4d36-8686-000000000019",
    //   relevance: 2,
    //   user_feedback: 0,
    //   session: "fcb6a685-eb92-4d36-8686-000000000001",
    //   query_count: 10,
    //   query_id: "fcb6a685-eb92-4d36-8686-000000000001",
    //   query_words: "transport mode",
    //   day: 2,
    //   url: "url-9",
    //   domain: "domain-9",
    //   rank: 9,
    //   user_action: 2,
    // },
  ];
}

function documents() {
  return [
    {
      id: "fcb6a685-eb92-4d36-8686-000000000000",
      rank: 0,
      title: "ship",
      snippet: "ship snippet",
      session: "fcb6a685-eb92-4d36-8686-000000000002",
      query_count: 1,
      query_id: "fcb6a685-eb92-4d36-8686-000000000001",
      query_words: "transport mode",
      url: "url-0",
      domain: "domain-0",
    },
    {
      id: "fcb6a685-eb92-4d36-8686-000000000001",
      rank: 1,
      title: "car",
      snippet: "car snippet",
      session: "fcb6a685-eb92-4d36-8686-000000000002",
      query_count: 2,
      query_id: "fcb6a685-eb92-4d36-8686-000000000001",
      query_words: "transport mode",
      url: "url-1",
      domain: "domain-1",
    },
    {
      id: "fcb6a685-eb92-4d36-8686-000000000002",
      rank: 2,
      title: "auto",
      snippet: "auto snippet",
      session: "fcb6a685-eb92-4d36-8686-000000000002",
      query_count: 3,
      query_id: "fcb6a685-eb92-4d36-8686-000000000001",
      query_words: "transport mode",
      url: "url-2",
      domain: "domain-2",
    },
    {
      id: "fcb6a685-eb92-4d36-8686-000000000003",
      rank: 3,
      title: "flugzeug",
      snippet: "flugzeug snippet",
      session: "fcb6a685-eb92-4d36-8686-000000000002",
      query_count: 4,
      query_id: "fcb6a685-eb92-4d36-8686-000000000001",
      query_words: "transport mode",
      url: "url-3",
      domain: "domain-3",
    },
    {
      id: "fcb6a685-eb92-4d36-8686-000000000004",
      rank: 4,
      title: "plane",
      snippet: "plane snippet",
      session: "fcb6a685-eb92-4d36-8686-000000000002",
      query_count: 5,
      query_id: "fcb6a685-eb92-4d36-8686-000000000001",
      query_words: "transport mode",
      url: "url-4",
      domain: "domain-4",
    },
    {
      id: "fcb6a685-eb92-4d36-8686-000000000005",
      rank: 5,
      title: "vehicle",
      snippet: "vehicle snippet",
      session: "fcb6a685-eb92-4d36-8686-000000000002",
      query_count: 6,
      query_id: "fcb6a685-eb92-4d36-8686-000000000001",
      query_words: "transport mode",
      url: "url-5",
      domain: "domain-5",
    },
    {
      id: "fcb6a685-eb92-4d36-8686-000000000006",
      rank: 6,
      title: "truck",
      snippet: "truck snippet",
      session: "fcb6a685-eb92-4d36-8686-000000000002",
      query_count: 7,
      query_id: "fcb6a685-eb92-4d36-8686-000000000001",
      query_words: "transport mode",
      url: "url-6",
      domain: "domain-6",
    },
    {
      id: "fcb6a685-eb92-4d36-8686-000000000007",
      rank: 7,
      title: "trunk",
      snippet: "trunk snippet",
      session: "fcb6a685-eb92-4d36-8686-000000000002",
      query_count: 8,
      query_id: "fcb6a685-eb92-4d36-8686-000000000001",
      query_words: "transport mode",
      url: "url-7",
      domain: "domain-7",
    },
    {
      id: "fcb6a685-eb92-4d36-8686-000000000008",
      rank: 8,
      title: "motorbike",
      snippet: "motorbike snippet",
      session: "fcb6a685-eb92-4d36-8686-000000000002",
      query_count: 9,
      query_id: "fcb6a685-eb92-4d36-8686-000000000001",
      query_words: "transport mode",
      url: "url-8",
      domain: "domain-8",
    },
    {
      id: "fcb6a685-eb92-4d36-8686-000000000009",
      rank: 9,
      title: "bicycle",
      snippet: "bicycle snippet",
      session: "fcb6a685-eb92-4d36-8686-000000000002",
      query_count: 10,
      query_id: "fcb6a685-eb92-4d36-8686-000000000001",
      query_words: "transport mode",
      url: "url-9",
      domain: "domain-9",
    },

    // {
    //   id: "fcb6a685-eb92-4d36-8686-000000000010",
    //   rank: 9,
    //   title: "bicycle",
    //   snippet: "bicycle snippet",
    //   session: "fcb6a685-eb92-4d36-8686-000000000002",
    //   query_count: 10,
    //   query_id: "fcb6a685-eb92-4d36-8686-000000000001",
    //   query_words: "transport mode",
    //   url: "url-9",
    //   domain: "domain-9",
    // },
    // {
    //   id: "fcb6a685-eb92-4d36-8686-000000000011",
    //   rank: 9,
    //   title: "bicycle",
    //   snippet: "bicycle snippet",
    //   session: "fcb6a685-eb92-4d36-8686-000000000002",
    //   query_count: 10,
    //   query_id: "fcb6a685-eb92-4d36-8686-000000000001",
    //   query_words: "transport mode",
    //   url: "url-9",
    //   domain: "domain-9",
    // },
    // {
    //   id: "fcb6a685-eb92-4d36-8686-000000000012",
    //   rank: 9,
    //   title: "bicycle",
    //   snippet: "bicycle snippet",
    //   session: "fcb6a685-eb92-4d36-8686-000000000002",
    //   query_count: 10,
    //   query_id: "fcb6a685-eb92-4d36-8686-000000000001",
    //   query_words: "transport mode",
    //   url: "url-9",
    //   domain: "domain-9",
    // },
    // {
    //   id: "fcb6a685-eb92-4d36-8686-000000000013",
    //   rank: 9,
    //   title: "bicycle",
    //   snippet: "bicycle snippet",
    //   session: "fcb6a685-eb92-4d36-8686-000000000002",
    //   query_count: 10,
    //   query_id: "fcb6a685-eb92-4d36-8686-000000000001",
    //   query_words: "transport mode",
    //   url: "url-9",
    //   domain: "domain-9",
    // },
    // {
    //   id: "fcb6a685-eb92-4d36-8686-000000000014",
    //   rank: 9,
    //   title: "bicycle",
    //   snippet: "bicycle snippet",
    //   session: "fcb6a685-eb92-4d36-8686-000000000002",
    //   query_count: 10,
    //   query_id: "fcb6a685-eb92-4d36-8686-000000000001",
    //   query_words: "transport mode",
    //   url: "url-9",
    //   domain: "domain-9",
    // },
    // {
    //   id: "fcb6a685-eb92-4d36-8686-000000000015",
    //   rank: 9,
    //   title: "bicycle",
    //   snippet: "bicycle snippet",
    //   session: "fcb6a685-eb92-4d36-8686-000000000002",
    //   query_count: 10,
    //   query_id: "fcb6a685-eb92-4d36-8686-000000000001",
    //   query_words: "transport mode",
    //   url: "url-9",
    //   domain: "domain-9",
    // },
    // {
    //   id: "fcb6a685-eb92-4d36-8686-000000000016",
    //   rank: 9,
    //   title: "bicycle",
    //   snippet: "bicycle snippet",
    //   session: "fcb6a685-eb92-4d36-8686-000000000002",
    //   query_count: 10,
    //   query_id: "fcb6a685-eb92-4d36-8686-000000000001",
    //   query_words: "transport mode",
    //   url: "url-9",
    //   domain: "domain-9",
    // },
    // {
    //   id: "fcb6a685-eb92-4d36-8686-000000000017",
    //   rank: 9,
    //   title: "bicycle",
    //   snippet: "bicycle snippet",
    //   session: "fcb6a685-eb92-4d36-8686-000000000002",
    //   query_count: 10,
    //   query_id: "fcb6a685-eb92-4d36-8686-000000000001",
    //   query_words: "transport mode",
    //   url: "url-9",
    //   domain: "domain-9",
    // },
    // {
    //   id: "fcb6a685-eb92-4d36-8686-000000000018",
    //   rank: 9,
    //   title: "bicycle",
    //   snippet: "bicycle snippet",
    //   session: "fcb6a685-eb92-4d36-8686-000000000002",
    //   query_count: 10,
    //   query_id: "fcb6a685-eb92-4d36-8686-000000000001",
    //   query_words: "transport mode",
    //   url: "url-9",
    //   domain: "domain-9",
    // },
    // {
    //   id: "fcb6a685-eb92-4d36-8686-000000000019",
    //   rank: 9,
    //   title: "bicycle",
    //   snippet: "bicycle snippet",
    //   session: "fcb6a685-eb92-4d36-8686-000000000002",
    //   query_count: 10,
    //   query_id: "fcb6a685-eb92-4d36-8686-000000000001",
    //   query_words: "transport mode",
    //   url: "url-9",
    //   domain: "domain-9",
    // },
  ];
}
